<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>pega-texto: Re.c</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">pega-texto
   </div>
   <div id="projectbrief">A runtime engine for Parsing Expression Grammars (PEG) in C</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Re.c</div>  </div>
</div><!--header-->
<div class="contents">
<p>Complex <a class="el" href="action_8h.html#a27822ec5a9ec2e2bf8854e10e8b8fdce" title="Action to be called on an Expression, after the whole match succeeds. ">pt_expression_action</a> example that creates PEGs using a Regex-like syntax, and then matches the syntax described by itself.</p>
<div class="fragment"><div class="line"><span class="comment">/* Regex-like syntax for creating pega-texto PEGs, parsed using pega-texto itself.</span></div><div class="line"><span class="comment"> * Creates the parser for this language from a textual self representation,</span></div><div class="line"><span class="comment"> * and then match itself.</span></div><div class="line"><span class="comment"> */</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="pega-texto_8h.html">pega-texto.h</a>&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="macro-on_8h.html">pega-texto/macro-on.h</a>&gt;</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;stdlib.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;ctype.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;string.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;stdarg.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;assert.h&gt;</span></div><div class="line"></div><div class="line"><span class="comment">// Parser Actions</span></div><div class="line"></div><div class="line"><a name="_a0"></a><a class="code" href="unionpt__data.html">pt_data</a> tonumber(<span class="keyword">const</span> <span class="keywordtype">char</span> *str, <span class="keywordtype">size_t</span> start, <span class="keywordtype">size_t</span> end, <span class="keywordtype">int</span> argc, <a class="code" href="unionpt__data.html">pt_data</a> *argv, <span class="keywordtype">void</span> *data) {</div><div class="line">    <span class="keywordflow">return</span> (<a class="code" href="unionpt__data.html">pt_data</a>){ .<a name="a1"></a>i = atoi(str + start) };</div><div class="line">}</div><div class="line"><a class="code" href="unionpt__data.html">pt_data</a> identifier(<span class="keyword">const</span> <span class="keywordtype">char</span> *str, <span class="keywordtype">size_t</span> start, <span class="keywordtype">size_t</span> end, <span class="keywordtype">int</span> argc, <a class="code" href="unionpt__data.html">pt_data</a> *argv, <span class="keywordtype">void</span> *data) {</div><div class="line">    assert(argc == 0 &amp;&amp; <span class="stringliteral">&quot;Identifier&quot;</span>);</div><div class="line">    <span class="keywordflow">return</span> (<a class="code" href="unionpt__data.html">pt_data</a>){ .p = strndup(str + start, end - start) };</div><div class="line">}</div><div class="line"><a class="code" href="unionpt__data.html">pt_data</a> defined(<span class="keyword">const</span> <span class="keywordtype">char</span> *str, <span class="keywordtype">size_t</span> start, <span class="keywordtype">size_t</span> end, <span class="keywordtype">int</span> argc, <a class="code" href="unionpt__data.html">pt_data</a> *argv, <span class="keywordtype">void</span> *data) {</div><div class="line">    assert(argc == 0 &amp;&amp; <span class="stringliteral">&quot;Defined&quot;</span>);</div><div class="line">    int (*f)(int);</div><div class="line">    <span class="keywordtype">char</span> c = str[start];</div><div class="line">    <span class="keywordflow">switch</span>(c) {</div><div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;w&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;W&#39;</span>: f = isalnum; <span class="keywordflow">break</span>;</div><div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;a&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;A&#39;</span>: f = isalpha; <span class="keywordflow">break</span>;</div><div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;c&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;C&#39;</span>: f = iscntrl; <span class="keywordflow">break</span>;</div><div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;d&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;D&#39;</span>: f = isdigit; <span class="keywordflow">break</span>;</div><div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;g&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;G&#39;</span>: f = isgraph; <span class="keywordflow">break</span>;</div><div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;l&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;L&#39;</span>: f = islower; <span class="keywordflow">break</span>;</div><div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;p&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;P&#39;</span>: f = ispunct; <span class="keywordflow">break</span>;</div><div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;s&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;S&#39;</span>: f = isspace; <span class="keywordflow">break</span>;</div><div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;u&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;U&#39;</span>: f = isupper; <span class="keywordflow">break</span>;</div><div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;x&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;X&#39;</span>: f = isxdigit; <span class="keywordflow">break</span>;</div><div class="line">        <span class="keywordflow">default</span>: assert(0 &amp;&amp; <span class="stringliteral">&quot;No way the class is not in [wWaAcCdDgGlLpPsSuUxX]&quot;</span>); <span class="keywordflow">break</span>;</div><div class="line">    }</div><div class="line">    <a name="_a2"></a><a class="code" href="structpt__expr.html">pt_expr</a> *e = <a name="a3"></a><a class="code" href="macro-on_8h.html#ab25baccb41e3b67ef0bfdaa1336c9649">F</a>(f);</div><div class="line">    <span class="keywordflow">if</span>(isupper(c)) {</div><div class="line">        e = <a name="a4"></a><a class="code" href="macro-on_8h.html#acbca2efeec65ad012d177b51b5c02eec">BUT</a>(e);</div><div class="line">    }</div><div class="line">    <span class="keywordflow">return</span> (<a class="code" href="unionpt__data.html">pt_data</a>){ .p = e };</div><div class="line">}</div><div class="line"><a class="code" href="unionpt__data.html">pt_data</a> forward_character(<span class="keyword">const</span> <span class="keywordtype">char</span> *str, <span class="keywordtype">size_t</span> start, <span class="keywordtype">size_t</span> end, <span class="keywordtype">int</span> argc, <a class="code" href="unionpt__data.html">pt_data</a> *argv, <span class="keywordtype">void</span> *data) {</div><div class="line">    <span class="keywordflow">return</span> (<a class="code" href="unionpt__data.html">pt_data</a>){ .<a name="a5"></a>c = str[start] };</div><div class="line">}</div><div class="line"><a class="code" href="unionpt__data.html">pt_data</a> character(<span class="keyword">const</span> <span class="keywordtype">char</span> *str, <span class="keywordtype">size_t</span> start, <span class="keywordtype">size_t</span> end, <span class="keywordtype">int</span> argc, <a class="code" href="unionpt__data.html">pt_data</a> *argv, <span class="keywordtype">void</span> *data) {</div><div class="line">    <span class="keywordtype">char</span> c = str[start];</div><div class="line">    <span class="keywordflow">if</span>(c == <span class="charliteral">&#39;\\&#39;</span>) {</div><div class="line">        c = str[start + 1];</div><div class="line">        <span class="keywordflow">if</span>(isdigit(c)) {</div><div class="line">            <span class="keywordtype">int</span> i;</div><div class="line">            c = c - <span class="charliteral">&#39;0&#39;</span>;</div><div class="line">            <span class="keywordflow">for</span>(i = 0; i &lt; argc; i++) {</div><div class="line">                c &lt;&lt;= 3;</div><div class="line">                c += argv[i].c - <span class="charliteral">&#39;0&#39;</span>;</div><div class="line">            }</div><div class="line">        }</div><div class="line">        <span class="keywordflow">else</span> {</div><div class="line">            <span class="keywordflow">switch</span>(c) {</div><div class="line">                <span class="keywordflow">case</span> <span class="charliteral">&#39;a&#39;</span>: c = <span class="charliteral">&#39;\a&#39;</span>; <span class="keywordflow">break</span>;</div><div class="line">                <span class="keywordflow">case</span> <span class="charliteral">&#39;b&#39;</span>: c = <span class="charliteral">&#39;\b&#39;</span>; <span class="keywordflow">break</span>;</div><div class="line">                <span class="keywordflow">case</span> <span class="charliteral">&#39;f&#39;</span>: c = <span class="charliteral">&#39;\f&#39;</span>; <span class="keywordflow">break</span>;</div><div class="line">                <span class="keywordflow">case</span> <span class="charliteral">&#39;n&#39;</span>: c = <span class="charliteral">&#39;\n&#39;</span>; <span class="keywordflow">break</span>;</div><div class="line">                <span class="keywordflow">case</span> <span class="charliteral">&#39;r&#39;</span>: c = <span class="charliteral">&#39;\r&#39;</span>; <span class="keywordflow">break</span>;</div><div class="line">                <span class="keywordflow">case</span> <span class="charliteral">&#39;t&#39;</span>: c = <span class="charliteral">&#39;\t&#39;</span>; <span class="keywordflow">break</span>;</div><div class="line">                <span class="keywordflow">case</span> <span class="charliteral">&#39;v&#39;</span>: c = <span class="charliteral">&#39;\v&#39;</span>; <span class="keywordflow">break</span>;</div><div class="line">                <span class="keywordflow">default</span>: <span class="keywordflow">break</span>;</div><div class="line">            }</div><div class="line">        }</div><div class="line">    }</div><div class="line">    <span class="keywordflow">return</span> (<a class="code" href="unionpt__data.html">pt_data</a>){ .c = c };</div><div class="line">}</div><div class="line"><a class="code" href="unionpt__data.html">pt_data</a> range(<span class="keyword">const</span> <span class="keywordtype">char</span> *str, <span class="keywordtype">size_t</span> start, <span class="keywordtype">size_t</span> end, <span class="keywordtype">int</span> argc, <a class="code" href="unionpt__data.html">pt_data</a> *argv, <span class="keywordtype">void</span> *data) {</div><div class="line">    assert(end - start == 3 &amp;&amp; <span class="stringliteral">&quot;Range&quot;</span>);</div><div class="line">    <span class="keywordtype">char</span> *r;</div><div class="line">    <a class="code" href="structpt__expr.html">pt_expr</a> *e = NULL;</div><div class="line">    <span class="keywordflow">if</span>(r = malloc(3 * <span class="keyword">sizeof</span>(<span class="keywordtype">char</span>))) {</div><div class="line">        r[0] = str[start];</div><div class="line">        r[1] = str[start + 2];</div><div class="line">        r[2] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line">        e = R_O(r);</div><div class="line">    }</div><div class="line">    <span class="keywordflow">return</span> (<a class="code" href="unionpt__data.html">pt_data</a>){ .p = e };</div><div class="line">}</div><div class="line"><a class="code" href="unionpt__data.html">pt_data</a> one_char(<span class="keyword">const</span> <span class="keywordtype">char</span> *str, <span class="keywordtype">size_t</span> start, <span class="keywordtype">size_t</span> end, <span class="keywordtype">int</span> argc, <a class="code" href="unionpt__data.html">pt_data</a> *argv, <span class="keywordtype">void</span> *data) {</div><div class="line">    assert(argc == 1 &amp;&amp; <span class="stringliteral">&quot;One char @ Item&quot;</span>);</div><div class="line">    <span class="keywordtype">char</span> *l;</div><div class="line">    <a class="code" href="structpt__expr.html">pt_expr</a> *e = NULL;</div><div class="line">    <span class="keywordflow">if</span>(l = malloc(2 * <span class="keyword">sizeof</span>(<span class="keywordtype">char</span>))) {</div><div class="line">        l[0] = argv[0].c;</div><div class="line">        l[1] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line">        e = L_O(l);</div><div class="line">    }</div><div class="line">    <span class="keywordflow">return</span> (<a class="code" href="unionpt__data.html">pt_data</a>){ .p = e };</div><div class="line">}</div><div class="line"><a class="code" href="unionpt__data.html">pt_data</a> literal(<span class="keyword">const</span> <span class="keywordtype">char</span> *str, <span class="keywordtype">size_t</span> start, <span class="keywordtype">size_t</span> end, <span class="keywordtype">int</span> argc, <a class="code" href="unionpt__data.html">pt_data</a> *argv, <span class="keywordtype">void</span> *data) {</div><div class="line">    <span class="keywordtype">char</span> *l;</div><div class="line">    <a class="code" href="structpt__expr.html">pt_expr</a> *e = NULL;</div><div class="line">    <span class="keywordflow">if</span>(l = malloc((argc + 1) * <span class="keyword">sizeof</span>(<span class="keywordtype">char</span>))) {</div><div class="line">        <span class="keywordtype">int</span> i;</div><div class="line">        <span class="keywordflow">for</span>(i = 0; i &lt; argc; i++) {</div><div class="line">            l[i] = argv[i].c;</div><div class="line">        }</div><div class="line">        l[i] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line">        e = L_O(l);</div><div class="line">    }</div><div class="line">    <span class="keywordflow">return</span> (<a class="code" href="unionpt__data.html">pt_data</a>){ .p = e };</div><div class="line">}</div><div class="line"><a class="code" href="unionpt__data.html">pt_data</a> char_class(<span class="keyword">const</span> <span class="keywordtype">char</span> *str, <span class="keywordtype">size_t</span> start, <span class="keywordtype">size_t</span> end, <span class="keywordtype">int</span> argc, <a class="code" href="unionpt__data.html">pt_data</a> *argv, <span class="keywordtype">void</span> *data) {</div><div class="line">    assert(argc &gt; 0 &amp;&amp; <span class="stringliteral">&quot;Class&quot;</span>);</div><div class="line">    <a class="code" href="structpt__expr.html">pt_expr</a> *e;</div><div class="line">    <span class="keywordflow">if</span>(argc &gt; 1) {</div><div class="line">        <a class="code" href="structpt__expr.html">pt_expr</a> **es;</div><div class="line">        <span class="keywordflow">if</span>(es = malloc(argc * <span class="keyword">sizeof</span>(<a class="code" href="structpt__expr.html">pt_expr</a> *))) {</div><div class="line">            <span class="keywordtype">int</span> i;</div><div class="line">            <span class="keywordflow">for</span>(i = 0; i &lt; argc; i++) {</div><div class="line">                es[i] = argv[i].<a name="a6"></a>p;</div><div class="line">            }</div><div class="line">            e = <a name="a7"></a><a class="code" href="expr_8h.html#a5dba39339b78ab80f09fe5fe612ceaed">pt_create_choice</a>(es, argc, 1, NULL);</div><div class="line">        }</div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span> {</div><div class="line">        e = argv[0].p;</div><div class="line">    }</div><div class="line">    <span class="comment">// it&#39;s a but: [^...]</span></div><div class="line">    <span class="keywordflow">if</span>(str[start + 1] == <span class="charliteral">&#39;^&#39;</span>) {</div><div class="line">        e = <a class="code" href="macro-on_8h.html#acbca2efeec65ad012d177b51b5c02eec">BUT</a>(e);</div><div class="line">    }</div><div class="line">    <span class="keywordflow">return</span> (<a class="code" href="unionpt__data.html">pt_data</a>){ .p = e };</div><div class="line">}</div><div class="line"><a class="code" href="unionpt__data.html">pt_data</a> non_terminal(<span class="keyword">const</span> <span class="keywordtype">char</span> *str, <span class="keywordtype">size_t</span> start, <span class="keywordtype">size_t</span> end, <span class="keywordtype">int</span> argc, <a class="code" href="unionpt__data.html">pt_data</a> *argv, <span class="keywordtype">void</span> *data) {</div><div class="line">    <span class="keywordflow">return</span> (<a class="code" href="unionpt__data.html">pt_data</a>){ .p = V_O(argv[0].p) };</div><div class="line">}</div><div class="line"><a class="code" href="unionpt__data.html">pt_data</a> build_grammar(<span class="keyword">const</span> <span class="keywordtype">char</span> *str, <span class="keywordtype">size_t</span> start, <span class="keywordtype">size_t</span> end, <span class="keywordtype">int</span> argc, <a class="code" href="unionpt__data.html">pt_data</a> *argv, <span class="keywordtype">void</span> *data) {</div><div class="line">    <span class="keywordtype">int</span> i, current, N = argc / 2;</div><div class="line">    <a name="_a8"></a><a class="code" href="structpt__rule.html">pt_rule</a> rules[N + 1];</div><div class="line">    <span class="keywordflow">for</span>(i = 0; i &lt; N; i++) {</div><div class="line">        current = i * 2;</div><div class="line">        rules[i].<a name="a9"></a><a class="code" href="structpt__rule.html#a8f8f80d37794cde9472343e4487ba3eb">name</a> = argv[current].p;</div><div class="line">        rules[i].<a name="a10"></a><a class="code" href="structpt__rule.html#aa8b7b07af83f55791affa514b9b05ddc">e</a> = argv[current + 1].p;</div><div class="line">    }</div><div class="line">    rules[i].<a class="code" href="structpt__rule.html#a8f8f80d37794cde9472343e4487ba3eb">name</a> = NULL;</div><div class="line">    rules[i].<a class="code" href="structpt__rule.html#aa8b7b07af83f55791affa514b9b05ddc">e</a> = NULL;</div><div class="line">    <span class="keywordflow">return</span> (<a class="code" href="unionpt__data.html">pt_data</a>){ .p = <a name="a11"></a><a class="code" href="grammar_8h.html#a7874095f872e56f9bf96c7c92dc7399d">pt_create_grammar</a>(rules, 1) };</div><div class="line">}</div><div class="line"><a class="code" href="unionpt__data.html">pt_data</a> create_any(<span class="keyword">const</span> <span class="keywordtype">char</span> *str, <span class="keywordtype">size_t</span> start, <span class="keywordtype">size_t</span> end, <span class="keywordtype">int</span> argc, <a class="code" href="unionpt__data.html">pt_data</a> *argv, <span class="keywordtype">void</span> *data) {</div><div class="line">    <span class="keywordflow">return</span> (<a class="code" href="unionpt__data.html">pt_data</a>){ .p = <a name="a12"></a><a class="code" href="macro-on_8h.html#a756cb5435a9a4479ee2066ab9da0dbae">ANY</a> };</div><div class="line">}</div><div class="line"><a class="code" href="unionpt__data.html">pt_data</a> with_action(<span class="keyword">const</span> <span class="keywordtype">char</span> *str, <span class="keywordtype">size_t</span> start, <span class="keywordtype">size_t</span> end, <span class="keywordtype">int</span> argc, <a class="code" href="unionpt__data.html">pt_data</a> *argv, <span class="keywordtype">void</span> *data) {</div><div class="line">    va_list *args = data;</div><div class="line">    ((<a class="code" href="structpt__expr.html">pt_expr</a> *) argv[0].p)-&gt;action = va_arg(*args, <a name="a13"></a><a class="code" href="action_8h.html#a27822ec5a9ec2e2bf8854e10e8b8fdce">pt_expression_action</a>);</div><div class="line">    <span class="keywordflow">return</span> argv[0];</div><div class="line">}</div><div class="line"><a class="code" href="unionpt__data.html">pt_data</a> quantifier(<span class="keyword">const</span> <span class="keywordtype">char</span> *str, <span class="keywordtype">size_t</span> start, <span class="keywordtype">size_t</span> end, <span class="keywordtype">int</span> argc, <a class="code" href="unionpt__data.html">pt_data</a> *argv, <span class="keywordtype">void</span> *data) {</div><div class="line">    <span class="keywordtype">int</span> N;</div><div class="line">    <span class="keywordflow">switch</span>(str[start]) {</div><div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;+&#39;</span>: N = 1; <span class="keywordflow">break</span>;</div><div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;*&#39;</span>: N = 0; <span class="keywordflow">break</span>;</div><div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;?&#39;</span>: N = -1; <span class="keywordflow">break</span>;</div><div class="line">        <span class="keywordflow">default</span>: assert(0 &amp;&amp; <span class="stringliteral">&quot;No way the quantifier is not in [+*?]&quot;</span>); <span class="keywordflow">break</span>;</div><div class="line">    }</div><div class="line">    <span class="keywordflow">return</span> (<a class="code" href="unionpt__data.html">pt_data</a>){ .i = N };</div><div class="line">}</div><div class="line"><a class="code" href="unionpt__data.html">pt_data</a> maybe_prefix(<span class="keyword">const</span> <span class="keywordtype">char</span> *str, <span class="keywordtype">size_t</span> start, <span class="keywordtype">size_t</span> end, <span class="keywordtype">int</span> argc, <a class="code" href="unionpt__data.html">pt_data</a> *argv, <span class="keywordtype">void</span> *data) {</div><div class="line">    assert(argc &gt; 0 &amp;&amp; <span class="stringliteral">&quot;Prefix&quot;</span>);</div><div class="line">    <a class="code" href="structpt__expr.html">pt_expr</a> *e = argv[0].p;</div><div class="line">    <span class="keywordflow">switch</span>(str[start]) {</div><div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;&amp;&#39;</span>: e = <a name="a14"></a><a class="code" href="macro-on_8h.html#af1e451fca58f94fdfd28b717d2188e61">AND</a>(e); <span class="keywordflow">break</span>;</div><div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;!&#39;</span>: e = <a name="a15"></a><a class="code" href="macro-on_8h.html#a0e656ebff6d3b76361f4ea16ccadad59">NOT</a>(e); <span class="keywordflow">break</span>;</div><div class="line">        <span class="keywordflow">default</span>: <span class="keywordflow">break</span>;</div><div class="line">    }</div><div class="line">    <span class="keywordflow">return</span> (<a class="code" href="unionpt__data.html">pt_data</a>){ .p = e };</div><div class="line">}</div><div class="line"><a class="code" href="unionpt__data.html">pt_data</a> maybe_quantifier(<span class="keyword">const</span> <span class="keywordtype">char</span> *str, <span class="keywordtype">size_t</span> start, <span class="keywordtype">size_t</span> end, <span class="keywordtype">int</span> argc, <a class="code" href="unionpt__data.html">pt_data</a> *argv, <span class="keywordtype">void</span> *data) {</div><div class="line">    assert(argc &gt; 0 &amp;&amp; <span class="stringliteral">&quot;Suffixed&quot;</span>);</div><div class="line">    <a class="code" href="structpt__expr.html">pt_expr</a> *e = argv[0].p;</div><div class="line">    <span class="keywordflow">if</span>(argc &gt; 1) {</div><div class="line">        e = <a name="a16"></a><a class="code" href="macro-on_8h.html#abe07a63385acc4dc5ceb4fc6ad206510">Q</a>(e, argv[1].i);</div><div class="line">    }</div><div class="line">    <span class="keywordflow">return</span> (<a class="code" href="unionpt__data.html">pt_data</a>){ .p = e };</div><div class="line">}</div><div class="line"><a class="code" href="unionpt__data.html">pt_data</a> maybe_seq(<span class="keyword">const</span> <span class="keywordtype">char</span> *str, <span class="keywordtype">size_t</span> start, <span class="keywordtype">size_t</span> end, <span class="keywordtype">int</span> argc, <a class="code" href="unionpt__data.html">pt_data</a> *argv, <span class="keywordtype">void</span> *data) {</div><div class="line">    assert(argc &gt; 0 &amp;&amp; <span class="stringliteral">&quot;Seq&quot;</span>);</div><div class="line">    <a class="code" href="structpt__expr.html">pt_expr</a> *e;</div><div class="line">    <span class="keywordflow">if</span>(argc &lt;= 1) {</div><div class="line">        e = argv[0].p;</div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span> {</div><div class="line">        <span class="keywordtype">int</span> i;</div><div class="line">        <a class="code" href="structpt__expr.html">pt_expr</a> **es;</div><div class="line">        <span class="keywordflow">if</span>(es = malloc(argc * <span class="keyword">sizeof</span>(<a class="code" href="structpt__expr.html">pt_expr</a> *))) {</div><div class="line">            <span class="keywordflow">for</span>(i = 0; i &lt; argc; i++) {</div><div class="line">                es[i] = argv[i].p;</div><div class="line">            }</div><div class="line">            e = <a name="a17"></a><a class="code" href="expr_8h.html#a125a0abd76d3d666c091e5a5737b1bc2">pt_create_sequence</a>(es, argc, 1, NULL);</div><div class="line">        }</div><div class="line">    }</div><div class="line">    <span class="keywordflow">return</span> (<a class="code" href="unionpt__data.html">pt_data</a>){ .p = e };</div><div class="line">}</div><div class="line"><a class="code" href="unionpt__data.html">pt_data</a> maybe_choice(<span class="keyword">const</span> <span class="keywordtype">char</span> *str, <span class="keywordtype">size_t</span> start, <span class="keywordtype">size_t</span> end, <span class="keywordtype">int</span> argc, <a class="code" href="unionpt__data.html">pt_data</a> *argv, <span class="keywordtype">void</span> *data) {</div><div class="line">    assert(argc &gt; 0 &amp;&amp; <span class="stringliteral">&quot;Exp&quot;</span>);</div><div class="line">    <a class="code" href="structpt__expr.html">pt_expr</a> *e;</div><div class="line">    <span class="keywordflow">if</span>(argc &lt;= 1) {</div><div class="line">        e = argv[0].p;</div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span> {</div><div class="line">        <span class="keywordtype">int</span> i;</div><div class="line">        <a class="code" href="structpt__expr.html">pt_expr</a> **es;</div><div class="line">        <span class="keywordflow">if</span>(es = malloc(argc * <span class="keyword">sizeof</span>(<a class="code" href="structpt__expr.html">pt_expr</a> *))) {</div><div class="line">            <span class="keywordflow">for</span>(i = 0; i &lt; argc; i++) {</div><div class="line">                es[i] = argv[i].p;</div><div class="line">            }</div><div class="line">            e = <a class="code" href="expr_8h.html#a5dba39339b78ab80f09fe5fe612ceaed">pt_create_choice</a>(es, argc, 1, NULL);</div><div class="line">        }</div><div class="line">    }</div><div class="line">    <span class="keywordflow">return</span> (<a class="code" href="unionpt__data.html">pt_data</a>){ .p = e };</div><div class="line">}</div><div class="line"></div><div class="line"><a name="_a18"></a><a class="code" href="structpt__grammar.html">pt_grammar</a> *create_grammar_from_string(<span class="keyword">const</span> <span class="keywordtype">char</span> *str, ...) {</div><div class="line">    <span class="comment">/* Grammar &lt;- S Definition+ !.</span></div><div class="line"><span class="comment">     * Definition &lt;- Identifier Arrow Exp</span></div><div class="line"><span class="comment">     *</span></div><div class="line"><span class="comment">     * Exp &lt;- Seq (&quot;/&quot; S Seq)*</span></div><div class="line"><span class="comment">     * Seq &lt;- Prefix+</span></div><div class="line"><span class="comment">     * Prefix &lt;- ([&amp;!] S)? Suffixed</span></div><div class="line"><span class="comment">     * Suffixed &lt;- Primary S Suffix?</span></div><div class="line"><span class="comment">     * Suffix &lt;- [+*?] S</span></div><div class="line"><span class="comment">     *         / &quot;^&quot; Number</span></div><div class="line"><span class="comment">     *</span></div><div class="line"><span class="comment">     * Primary &lt;- &quot;(&quot; S Exp &quot;)&quot; S</span></div><div class="line"><span class="comment">     *          / &quot;{&quot; S Exp &quot;}&quot; S</span></div><div class="line"><span class="comment">     *          / Defined</span></div><div class="line"><span class="comment">     *          / Literal</span></div><div class="line"><span class="comment">     *          / Class</span></div><div class="line"><span class="comment">     *          / &quot;.&quot; S</span></div><div class="line"><span class="comment">     *          / Identifier !Arrow</span></div><div class="line"><span class="comment">     *</span></div><div class="line"><span class="comment">     * Literal &lt;- &#39;&quot;&#39; (!&#39;&quot;&#39; Character)* &#39;&quot;&#39; S</span></div><div class="line"><span class="comment">     *          / &quot;&#39;&quot; (!&quot;&#39;&quot; Character)* &quot;&#39;&quot; S</span></div><div class="line"><span class="comment">     * Class &lt;- &quot;[&quot; &quot;^&quot;? Item (!&quot;]&quot; Item)* &quot;]&quot; S</span></div><div class="line"><span class="comment">     * Item &lt;- Defined / Range / .</span></div><div class="line"><span class="comment">     * Range &lt;- . &quot;-&quot; [^]]</span></div><div class="line"><span class="comment">     * Character &lt;- &quot;\\&quot; [abfnrtv&#39;&quot;\[\]\\]</span></div><div class="line"><span class="comment">     *            / &quot;\\&quot; [0-2][0-7][0-7]</span></div><div class="line"><span class="comment">     *            / &quot;\\&quot; [0-7][0-7]?</span></div><div class="line"><span class="comment">     *            / .</span></div><div class="line"><span class="comment">     * Defined &lt;- &quot;\\&quot; [wWaAcCdDgGlLpPsSuUxX] S</span></div><div class="line"><span class="comment">     *</span></div><div class="line"><span class="comment">     * S &lt;- (\s / &quot;#&quot; [^\n]*)*</span></div><div class="line"><span class="comment">     * Identifier &lt;- [A-Za-z_][A-Za-z0-9_-]* S</span></div><div class="line"><span class="comment">     * Arrow &lt;- &quot;&lt;-&quot; S</span></div><div class="line"><span class="comment">     * Number &lt;- [+-]? \d+ S</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <a class="code" href="structpt__rule.html">pt_rule</a> rules[] = {</div><div class="line">        { <span class="stringliteral">&quot;Grammar&quot;</span>, SEQ_(build_grammar, <a name="a19"></a><a class="code" href="macro-on_8h.html#ad187b264cc8b274131c2009ec2359a1c">V</a>(<span class="stringliteral">&quot;S&quot;</span>), <a class="code" href="macro-on_8h.html#abe07a63385acc4dc5ceb4fc6ad206510">Q</a>(<a class="code" href="macro-on_8h.html#ad187b264cc8b274131c2009ec2359a1c">V</a>(<span class="stringliteral">&quot;Definition&quot;</span>), 1), <a class="code" href="macro-on_8h.html#a0e656ebff6d3b76361f4ea16ccadad59">NOT</a>(<a class="code" href="macro-on_8h.html#a756cb5435a9a4479ee2066ab9da0dbae">ANY</a>)) },</div><div class="line">        { <span class="stringliteral">&quot;Definition&quot;</span>, <a name="a20"></a><a class="code" href="macro-on_8h.html#a1fbce1ef13f8b74cfd3c6ee4baa25ba3">SEQ</a>(<a class="code" href="macro-on_8h.html#ad187b264cc8b274131c2009ec2359a1c">V</a>(<span class="stringliteral">&quot;Identifier&quot;</span>), <a class="code" href="macro-on_8h.html#ad187b264cc8b274131c2009ec2359a1c">V</a>(<span class="stringliteral">&quot;Arrow&quot;</span>), <a class="code" href="macro-on_8h.html#ad187b264cc8b274131c2009ec2359a1c">V</a>(<span class="stringliteral">&quot;Exp&quot;</span>)) },</div><div class="line"></div><div class="line">        { <span class="stringliteral">&quot;Exp&quot;</span>, SEQ_(maybe_choice, <a class="code" href="macro-on_8h.html#ad187b264cc8b274131c2009ec2359a1c">V</a>(<span class="stringliteral">&quot;Seq&quot;</span>), <a class="code" href="macro-on_8h.html#abe07a63385acc4dc5ceb4fc6ad206510">Q</a>(<a class="code" href="macro-on_8h.html#a1fbce1ef13f8b74cfd3c6ee4baa25ba3">SEQ</a>(<a name="a21"></a><a class="code" href="macro-on_8h.html#a3948ef94e164df6b50c4a9d12ba60eb5">L</a>(<span class="stringliteral">&quot;/&quot;</span>), <a class="code" href="macro-on_8h.html#ad187b264cc8b274131c2009ec2359a1c">V</a>(<span class="stringliteral">&quot;S&quot;</span>), <a class="code" href="macro-on_8h.html#ad187b264cc8b274131c2009ec2359a1c">V</a>(<span class="stringliteral">&quot;Seq&quot;</span>)), 0)) },</div><div class="line">        { <span class="stringliteral">&quot;Seq&quot;</span>, Q_(maybe_seq, <a class="code" href="macro-on_8h.html#ad187b264cc8b274131c2009ec2359a1c">V</a>(<span class="stringliteral">&quot;Prefix&quot;</span>), 1) },</div><div class="line">        { <span class="stringliteral">&quot;Prefix&quot;</span>, SEQ_(maybe_prefix, <a class="code" href="macro-on_8h.html#abe07a63385acc4dc5ceb4fc6ad206510">Q</a>(<a class="code" href="macro-on_8h.html#a1fbce1ef13f8b74cfd3c6ee4baa25ba3">SEQ</a>(<a name="a22"></a><a class="code" href="macro-on_8h.html#a8fa17c8cf4c36df48f4108c36da8573e">S</a>(<span class="stringliteral">&quot;&amp;!&quot;</span>), <a class="code" href="macro-on_8h.html#ad187b264cc8b274131c2009ec2359a1c">V</a>(<span class="stringliteral">&quot;S&quot;</span>)), -1), <a class="code" href="macro-on_8h.html#ad187b264cc8b274131c2009ec2359a1c">V</a>(<span class="stringliteral">&quot;Suffixed&quot;</span>)) },</div><div class="line">        { <span class="stringliteral">&quot;Suffixed&quot;</span>, SEQ_(maybe_quantifier, <a class="code" href="macro-on_8h.html#ad187b264cc8b274131c2009ec2359a1c">V</a>(<span class="stringliteral">&quot;Primary&quot;</span>), <a class="code" href="macro-on_8h.html#abe07a63385acc4dc5ceb4fc6ad206510">Q</a>(<a class="code" href="macro-on_8h.html#ad187b264cc8b274131c2009ec2359a1c">V</a>(<span class="stringliteral">&quot;Suffix&quot;</span>), -1)) },</div><div class="line">        { <span class="stringliteral">&quot;Suffix&quot;</span>, <a name="a23"></a><a class="code" href="macro-on_8h.html#aa8c4cbd9ef7da8b278b5f80373eadae5">OR</a>(<a class="code" href="macro-on_8h.html#a1fbce1ef13f8b74cfd3c6ee4baa25ba3">SEQ</a>(S_(quantifier, <span class="stringliteral">&quot;+*?&quot;</span>), <a class="code" href="macro-on_8h.html#ad187b264cc8b274131c2009ec2359a1c">V</a>(<span class="stringliteral">&quot;S&quot;</span>)), <a class="code" href="macro-on_8h.html#a1fbce1ef13f8b74cfd3c6ee4baa25ba3">SEQ</a>(<a class="code" href="macro-on_8h.html#a3948ef94e164df6b50c4a9d12ba60eb5">L</a>(<span class="stringliteral">&quot;^&quot;</span>), <a class="code" href="macro-on_8h.html#ad187b264cc8b274131c2009ec2359a1c">V</a>(<span class="stringliteral">&quot;Number&quot;</span>))) },</div><div class="line"></div><div class="line">        { <span class="stringliteral">&quot;Primary&quot;</span>, <a class="code" href="macro-on_8h.html#aa8c4cbd9ef7da8b278b5f80373eadae5">OR</a>(<a class="code" href="macro-on_8h.html#a1fbce1ef13f8b74cfd3c6ee4baa25ba3">SEQ</a>(<a class="code" href="macro-on_8h.html#a3948ef94e164df6b50c4a9d12ba60eb5">L</a>(<span class="stringliteral">&quot;(&quot;</span>), <a class="code" href="macro-on_8h.html#ad187b264cc8b274131c2009ec2359a1c">V</a>(<span class="stringliteral">&quot;S&quot;</span>), <a class="code" href="macro-on_8h.html#ad187b264cc8b274131c2009ec2359a1c">V</a>(<span class="stringliteral">&quot;Exp&quot;</span>), <a class="code" href="macro-on_8h.html#a3948ef94e164df6b50c4a9d12ba60eb5">L</a>(<span class="stringliteral">&quot;)&quot;</span>), <a class="code" href="macro-on_8h.html#ad187b264cc8b274131c2009ec2359a1c">V</a>(<span class="stringliteral">&quot;S&quot;</span>)),</div><div class="line">                        SEQ_(with_action, <a class="code" href="macro-on_8h.html#a3948ef94e164df6b50c4a9d12ba60eb5">L</a>(<span class="stringliteral">&quot;{&quot;</span>), <a class="code" href="macro-on_8h.html#ad187b264cc8b274131c2009ec2359a1c">V</a>(<span class="stringliteral">&quot;S&quot;</span>), <a class="code" href="macro-on_8h.html#ad187b264cc8b274131c2009ec2359a1c">V</a>(<span class="stringliteral">&quot;Exp&quot;</span>), <a class="code" href="macro-on_8h.html#a3948ef94e164df6b50c4a9d12ba60eb5">L</a>(<span class="stringliteral">&quot;}&quot;</span>), <a class="code" href="macro-on_8h.html#ad187b264cc8b274131c2009ec2359a1c">V</a>(<span class="stringliteral">&quot;S&quot;</span>)),</div><div class="line">                        <a class="code" href="macro-on_8h.html#ad187b264cc8b274131c2009ec2359a1c">V</a>(<span class="stringliteral">&quot;Defined&quot;</span>),</div><div class="line">                        <a class="code" href="macro-on_8h.html#ad187b264cc8b274131c2009ec2359a1c">V</a>(<span class="stringliteral">&quot;Literal&quot;</span>),</div><div class="line">                        <a class="code" href="macro-on_8h.html#ad187b264cc8b274131c2009ec2359a1c">V</a>(<span class="stringliteral">&quot;Class&quot;</span>),</div><div class="line">                        SEQ_(create_any, <a class="code" href="macro-on_8h.html#a3948ef94e164df6b50c4a9d12ba60eb5">L</a>(<span class="stringliteral">&quot;.&quot;</span>), <a class="code" href="macro-on_8h.html#ad187b264cc8b274131c2009ec2359a1c">V</a>(<span class="stringliteral">&quot;S&quot;</span>)),</div><div class="line">                        <a class="code" href="macro-on_8h.html#a1fbce1ef13f8b74cfd3c6ee4baa25ba3">SEQ</a>(V_(non_terminal, <span class="stringliteral">&quot;Identifier&quot;</span>), <a class="code" href="macro-on_8h.html#a0e656ebff6d3b76361f4ea16ccadad59">NOT</a>(<a class="code" href="macro-on_8h.html#ad187b264cc8b274131c2009ec2359a1c">V</a>(<span class="stringliteral">&quot;Arrow&quot;</span>)))) },</div><div class="line">        { <span class="stringliteral">&quot;Literal&quot;</span>, OR_(literal,</div><div class="line">                         <a class="code" href="macro-on_8h.html#a1fbce1ef13f8b74cfd3c6ee4baa25ba3">SEQ</a>(<a class="code" href="macro-on_8h.html#a3948ef94e164df6b50c4a9d12ba60eb5">L</a>(<span class="stringliteral">&quot;\&quot;&quot;</span>), <a class="code" href="macro-on_8h.html#abe07a63385acc4dc5ceb4fc6ad206510">Q</a>(<a class="code" href="macro-on_8h.html#a1fbce1ef13f8b74cfd3c6ee4baa25ba3">SEQ</a>(<a class="code" href="macro-on_8h.html#a0e656ebff6d3b76361f4ea16ccadad59">NOT</a>(<a class="code" href="macro-on_8h.html#a3948ef94e164df6b50c4a9d12ba60eb5">L</a>(<span class="stringliteral">&quot;\&quot;&quot;</span>)), <a class="code" href="macro-on_8h.html#ad187b264cc8b274131c2009ec2359a1c">V</a>(<span class="stringliteral">&quot;Character&quot;</span>)), 0), <a class="code" href="macro-on_8h.html#a3948ef94e164df6b50c4a9d12ba60eb5">L</a>(<span class="stringliteral">&quot;\&quot;&quot;</span>), <a class="code" href="macro-on_8h.html#ad187b264cc8b274131c2009ec2359a1c">V</a>(<span class="stringliteral">&quot;S&quot;</span>)),</div><div class="line">                         <a class="code" href="macro-on_8h.html#a1fbce1ef13f8b74cfd3c6ee4baa25ba3">SEQ</a>(<a class="code" href="macro-on_8h.html#a3948ef94e164df6b50c4a9d12ba60eb5">L</a>(<span class="stringliteral">&quot;\&#39;&quot;</span>), <a class="code" href="macro-on_8h.html#abe07a63385acc4dc5ceb4fc6ad206510">Q</a>(<a class="code" href="macro-on_8h.html#a1fbce1ef13f8b74cfd3c6ee4baa25ba3">SEQ</a>(<a class="code" href="macro-on_8h.html#a0e656ebff6d3b76361f4ea16ccadad59">NOT</a>(<a class="code" href="macro-on_8h.html#a3948ef94e164df6b50c4a9d12ba60eb5">L</a>(<span class="stringliteral">&quot;\&#39;&quot;</span>)), <a class="code" href="macro-on_8h.html#ad187b264cc8b274131c2009ec2359a1c">V</a>(<span class="stringliteral">&quot;Character&quot;</span>)), 0), <a class="code" href="macro-on_8h.html#a3948ef94e164df6b50c4a9d12ba60eb5">L</a>(<span class="stringliteral">&quot;\&#39;&quot;</span>), <a class="code" href="macro-on_8h.html#ad187b264cc8b274131c2009ec2359a1c">V</a>(<span class="stringliteral">&quot;S&quot;</span>))) },</div><div class="line">        { <span class="stringliteral">&quot;Class&quot;</span>, SEQ_(char_class, <a class="code" href="macro-on_8h.html#a3948ef94e164df6b50c4a9d12ba60eb5">L</a>(<span class="stringliteral">&quot;[&quot;</span>), <a class="code" href="macro-on_8h.html#abe07a63385acc4dc5ceb4fc6ad206510">Q</a>(<a class="code" href="macro-on_8h.html#a3948ef94e164df6b50c4a9d12ba60eb5">L</a>(<span class="stringliteral">&quot;^&quot;</span>), -1), <a class="code" href="macro-on_8h.html#ad187b264cc8b274131c2009ec2359a1c">V</a>(<span class="stringliteral">&quot;Item&quot;</span>), <a class="code" href="macro-on_8h.html#abe07a63385acc4dc5ceb4fc6ad206510">Q</a>(<a class="code" href="macro-on_8h.html#a1fbce1ef13f8b74cfd3c6ee4baa25ba3">SEQ</a>(<a class="code" href="macro-on_8h.html#a0e656ebff6d3b76361f4ea16ccadad59">NOT</a>(<a class="code" href="macro-on_8h.html#a3948ef94e164df6b50c4a9d12ba60eb5">L</a>(<span class="stringliteral">&quot;]&quot;</span>)), <a class="code" href="macro-on_8h.html#ad187b264cc8b274131c2009ec2359a1c">V</a>(<span class="stringliteral">&quot;Item&quot;</span>)), 0), <a class="code" href="macro-on_8h.html#a3948ef94e164df6b50c4a9d12ba60eb5">L</a>(<span class="stringliteral">&quot;]&quot;</span>), <a class="code" href="macro-on_8h.html#ad187b264cc8b274131c2009ec2359a1c">V</a>(<span class="stringliteral">&quot;S&quot;</span>)) },</div><div class="line">        { <span class="stringliteral">&quot;Item&quot;</span>, <a class="code" href="macro-on_8h.html#aa8c4cbd9ef7da8b278b5f80373eadae5">OR</a>(<a class="code" href="macro-on_8h.html#ad187b264cc8b274131c2009ec2359a1c">V</a>(<span class="stringliteral">&quot;Defined&quot;</span>), <a class="code" href="macro-on_8h.html#ad187b264cc8b274131c2009ec2359a1c">V</a>(<span class="stringliteral">&quot;Range&quot;</span>), V_(one_char, <span class="stringliteral">&quot;Character&quot;</span>)) },</div><div class="line">        { <span class="stringliteral">&quot;Range&quot;</span>, SEQ_(range, <a class="code" href="macro-on_8h.html#a756cb5435a9a4479ee2066ab9da0dbae">ANY</a>, <a class="code" href="macro-on_8h.html#a3948ef94e164df6b50c4a9d12ba60eb5">L</a>(<span class="stringliteral">&quot;-&quot;</span>), <a class="code" href="macro-on_8h.html#acbca2efeec65ad012d177b51b5c02eec">BUT</a>(<a class="code" href="macro-on_8h.html#a3948ef94e164df6b50c4a9d12ba60eb5">L</a>(<span class="stringliteral">&quot;]&quot;</span>))) },</div><div class="line">        { <span class="stringliteral">&quot;Character&quot;</span>, OR_(character,</div><div class="line">                           <a class="code" href="macro-on_8h.html#a1fbce1ef13f8b74cfd3c6ee4baa25ba3">SEQ</a>(<a class="code" href="macro-on_8h.html#a3948ef94e164df6b50c4a9d12ba60eb5">L</a>(<span class="stringliteral">&quot;\\&quot;</span>), <a class="code" href="macro-on_8h.html#a8fa17c8cf4c36df48f4108c36da8573e">S</a>(<span class="stringliteral">&quot;abfnrtv\&#39;\&quot;[]\\&quot;</span>)),</div><div class="line">                           <a class="code" href="macro-on_8h.html#a1fbce1ef13f8b74cfd3c6ee4baa25ba3">SEQ</a>(<a class="code" href="macro-on_8h.html#a3948ef94e164df6b50c4a9d12ba60eb5">L</a>(<span class="stringliteral">&quot;\\&quot;</span>), <a name="a24"></a><a class="code" href="macro-on_8h.html#a8ecf6161916e39d1d6bae3868815dbed">R</a>(<span class="stringliteral">&quot;02&quot;</span>), R_(forward_character, <span class="stringliteral">&quot;07&quot;</span>), R_(forward_character, <span class="stringliteral">&quot;07&quot;</span>)),</div><div class="line">                           <a class="code" href="macro-on_8h.html#a1fbce1ef13f8b74cfd3c6ee4baa25ba3">SEQ</a>(<a class="code" href="macro-on_8h.html#a3948ef94e164df6b50c4a9d12ba60eb5">L</a>(<span class="stringliteral">&quot;\\&quot;</span>), <a class="code" href="macro-on_8h.html#a8ecf6161916e39d1d6bae3868815dbed">R</a>(<span class="stringliteral">&quot;07&quot;</span>), <a class="code" href="macro-on_8h.html#abe07a63385acc4dc5ceb4fc6ad206510">Q</a>(R_(forward_character, <span class="stringliteral">&quot;07&quot;</span>), -1)),</div><div class="line">                           <a class="code" href="macro-on_8h.html#a756cb5435a9a4479ee2066ab9da0dbae">ANY</a>) },</div><div class="line">        { <span class="stringliteral">&quot;Defined&quot;</span>, <a class="code" href="macro-on_8h.html#a1fbce1ef13f8b74cfd3c6ee4baa25ba3">SEQ</a>(<a class="code" href="macro-on_8h.html#a3948ef94e164df6b50c4a9d12ba60eb5">L</a>(<span class="stringliteral">&quot;\\&quot;</span>), S_(defined, <span class="stringliteral">&quot;wWaAcCdDgGlLpPsSuUxX&quot;</span>), <a class="code" href="macro-on_8h.html#ad187b264cc8b274131c2009ec2359a1c">V</a>(<span class="stringliteral">&quot;S&quot;</span>)) },</div><div class="line"></div><div class="line">        { <span class="stringliteral">&quot;S&quot;</span>, <a class="code" href="macro-on_8h.html#abe07a63385acc4dc5ceb4fc6ad206510">Q</a>(<a class="code" href="macro-on_8h.html#aa8c4cbd9ef7da8b278b5f80373eadae5">OR</a>(<a class="code" href="macro-on_8h.html#ab25baccb41e3b67ef0bfdaa1336c9649">F</a>(isspace), <a class="code" href="macro-on_8h.html#a1fbce1ef13f8b74cfd3c6ee4baa25ba3">SEQ</a>(<a class="code" href="macro-on_8h.html#a3948ef94e164df6b50c4a9d12ba60eb5">L</a>(<span class="stringliteral">&quot;#&quot;</span>), <a class="code" href="macro-on_8h.html#abe07a63385acc4dc5ceb4fc6ad206510">Q</a>(<a class="code" href="macro-on_8h.html#acbca2efeec65ad012d177b51b5c02eec">BUT</a>(<a class="code" href="macro-on_8h.html#a3948ef94e164df6b50c4a9d12ba60eb5">L</a>(<span class="stringliteral">&quot;\n&quot;</span>)), 0))), 0) },</div><div class="line">        { <span class="stringliteral">&quot;Identifier&quot;</span>, <a class="code" href="macro-on_8h.html#a1fbce1ef13f8b74cfd3c6ee4baa25ba3">SEQ</a>(SEQ_(identifier, <a class="code" href="macro-on_8h.html#aa8c4cbd9ef7da8b278b5f80373eadae5">OR</a>(<a class="code" href="macro-on_8h.html#ab25baccb41e3b67ef0bfdaa1336c9649">F</a>(isalpha), <a class="code" href="macro-on_8h.html#a3948ef94e164df6b50c4a9d12ba60eb5">L</a>(<span class="stringliteral">&quot;_&quot;</span>)), <a class="code" href="macro-on_8h.html#abe07a63385acc4dc5ceb4fc6ad206510">Q</a>(<a class="code" href="macro-on_8h.html#aa8c4cbd9ef7da8b278b5f80373eadae5">OR</a>(<a class="code" href="macro-on_8h.html#ab25baccb41e3b67ef0bfdaa1336c9649">F</a>(isalnum), <a class="code" href="macro-on_8h.html#a8fa17c8cf4c36df48f4108c36da8573e">S</a>(<span class="stringliteral">&quot;_-&quot;</span>)), 0)), <a class="code" href="macro-on_8h.html#ad187b264cc8b274131c2009ec2359a1c">V</a>(<span class="stringliteral">&quot;S&quot;</span>)) },</div><div class="line">        { <span class="stringliteral">&quot;Arrow&quot;</span>, <a class="code" href="macro-on_8h.html#a1fbce1ef13f8b74cfd3c6ee4baa25ba3">SEQ</a>(<a class="code" href="macro-on_8h.html#a3948ef94e164df6b50c4a9d12ba60eb5">L</a>(<span class="stringliteral">&quot;&lt;-&quot;</span>), <a class="code" href="macro-on_8h.html#ad187b264cc8b274131c2009ec2359a1c">V</a>(<span class="stringliteral">&quot;S&quot;</span>)) },</div><div class="line">        { <span class="stringliteral">&quot;Number&quot;</span>, SEQ_(tonumber, <a class="code" href="macro-on_8h.html#abe07a63385acc4dc5ceb4fc6ad206510">Q</a>(<a class="code" href="macro-on_8h.html#a8fa17c8cf4c36df48f4108c36da8573e">S</a>(<span class="stringliteral">&quot;+-&quot;</span>), -1), <a class="code" href="macro-on_8h.html#abe07a63385acc4dc5ceb4fc6ad206510">Q</a>(<a class="code" href="macro-on_8h.html#ab25baccb41e3b67ef0bfdaa1336c9649">F</a>(isdigit), 1), <a class="code" href="macro-on_8h.html#ad187b264cc8b274131c2009ec2359a1c">V</a>(<span class="stringliteral">&quot;S&quot;</span>)) },</div><div class="line">        { NULL, NULL },</div><div class="line">    };</div><div class="line">    <a class="code" href="structpt__grammar.html">pt_grammar</a> *re = <a class="code" href="grammar_8h.html#a7874095f872e56f9bf96c7c92dc7399d">pt_create_grammar</a>(rules, 0);</div><div class="line">    <a name="a25"></a><a class="code" href="validate_8h.html#a70e2c6d46c25dfb416cc530d8badaf0d">pt_validate_grammar</a>(re, <a name="a26"></a><a class="code" href="validate_8h.html#aaa7d39cc766a4fa8174efcd4e83f2244a0bb41d24958fe31b0c874e93bf4b5127">PT_VALIDATE_ABORT</a>);</div><div class="line"></div><div class="line">    <span class="comment">// Expression Actions</span></div><div class="line">    va_list actions;</div><div class="line">    va_start(actions, str);</div><div class="line">    <a name="_a27"></a><a class="code" href="structpt__match__options.html">pt_match_options</a> opts = { .<a name="a28"></a><a class="code" href="structpt__match__options.html#afd0ffb02780e738d4c0a10ab833b7834">userdata</a> = &amp;actions };</div><div class="line"></div><div class="line">    <a name="_a29"></a><a class="code" href="structpt__match__result.html">pt_match_result</a> res = <a name="a30"></a><a class="code" href="match_8h.html#a785fdb8caba03abc57ebd541b45bcb37">pt_match_grammar</a>(re, str, &amp;opts);</div><div class="line">    <a class="code" href="structpt__grammar.html">pt_grammar</a> *g = NULL;</div><div class="line">    <span class="keywordflow">if</span>(res.<a name="a31"></a><a class="code" href="structpt__match__result.html#a2cac697b53844ad0bb0ab9487798c50f">matched</a> &gt;= 0) {</div><div class="line">        g = res.<a name="a32"></a><a class="code" href="structpt__match__result.html#a3e2395bb9e7a99111250ab2a8f1519ec">data</a>.p;</div><div class="line">    }</div><div class="line"></div><div class="line">    va_end(actions);</div><div class="line">    <a name="a33"></a><a class="code" href="grammar_8h.html#a89110044150ef30bf164bb83fccb2363">pt_destroy_grammar</a>(re);</div><div class="line">    <span class="keywordflow">return</span> g;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">char</span> *readfile(<span class="keyword">const</span> <span class="keywordtype">char</span> *filename) {</div><div class="line">    FILE *fp = fopen(filename, <span class="stringliteral">&quot;r&quot;</span>);</div><div class="line">    assert(fp != NULL &amp;&amp; <span class="stringliteral">&quot;Error reading file&quot;</span>);</div><div class="line">    fseek(fp, 0, SEEK_END);</div><div class="line">    <span class="keywordtype">long</span> size = ftell(fp);</div><div class="line">    fseek(fp, 0, SEEK_SET);</div><div class="line">    <span class="keywordtype">char</span> *buffer = malloc((size + 1) * <span class="keyword">sizeof</span>(<span class="keywordtype">char</span>));</div><div class="line">    assert(buffer &amp;&amp; <span class="stringliteral">&quot;[readfile] Couldn&#39;t malloc buffer&quot;</span>);</div><div class="line">    fread(buffer, <span class="keyword">sizeof</span>(<span class="keywordtype">char</span>), size, fp);</div><div class="line">    buffer[size] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line">    fclose(fp);</div><div class="line">    <span class="keywordflow">return</span> buffer;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv) {</div><div class="line">    <span class="keywordtype">char</span> re_grammar[] =</div><div class="line"><span class="stringliteral">&quot;Grammar &lt;- S Definition+ !. \n&quot;</span></div><div class="line"><span class="stringliteral">&quot;Definition &lt;- Identifier Arrow Exp \n&quot;</span></div><div class="line"></div><div class="line"><span class="stringliteral">&quot;Exp &lt;- Seq (\&quot;/\&quot; S Seq)* \n&quot;</span></div><div class="line"><span class="stringliteral">&quot;Seq &lt;- Prefix+ \n&quot;</span></div><div class="line"><span class="stringliteral">&quot;Prefix &lt;- ([&amp;!] S)? Suffixed \n&quot;</span></div><div class="line"><span class="stringliteral">&quot;Suffixed &lt;- Primary Suffix? \n&quot;</span></div><div class="line"><span class="stringliteral">&quot;Suffix &lt;- [+*?] S \n&quot;</span></div><div class="line"><span class="stringliteral">&quot;        / \&quot;^\&quot; Number \n&quot;</span></div><div class="line"></div><div class="line"><span class="stringliteral">&quot;Primary &lt;- \&quot;(\&quot; S Exp \&quot;)\&quot; S \n&quot;</span></div><div class="line"><span class="stringliteral">&quot;         / \&quot;{\&quot; S Exp \&quot;}\&quot; S \n&quot;</span></div><div class="line"><span class="stringliteral">&quot;         / Defined \n&quot;</span></div><div class="line"><span class="stringliteral">&quot;         / Literal \n&quot;</span></div><div class="line"><span class="stringliteral">&quot;         / Class \n&quot;</span></div><div class="line"><span class="stringliteral">&quot;         / \&quot;.\&quot; S \n&quot;</span></div><div class="line"><span class="stringliteral">&quot;         / Identifier !Arrow \n&quot;</span></div><div class="line"></div><div class="line"><span class="stringliteral">&quot;Literal &lt;- \&#39;\&quot;\&#39; (!\&#39;\&quot;\&#39; Character)* \&#39;\&quot;\&#39; S \n&quot;</span></div><div class="line"><span class="stringliteral">&quot;         / \&quot;\&#39;\&quot; (!\&quot;\&#39;\&quot; Character)* \&quot;\&#39;\&quot; S \n&quot;</span></div><div class="line"><span class="stringliteral">&quot;Class &lt;- \&quot;[\&quot; \&quot;^\&quot;? Item (!\&quot;]\&quot; Item)* \&quot;]\&quot; S \n&quot;</span></div><div class="line"><span class="stringliteral">&quot;Item &lt;- Defined / Range / Character \n&quot;</span></div><div class="line"><span class="stringliteral">&quot;Range &lt;- . \&quot;-\&quot; [^]] \n&quot;</span></div><div class="line"><span class="stringliteral">&quot;Character &lt;- \&quot;\\\\\&quot; [abfnrtv\&#39;\&quot;\\[\\]\\\\] \n&quot;</span></div><div class="line"><span class="stringliteral">&quot;           / \&quot;\\\\\&quot; [0-2][0-7][0-7] \n&quot;</span></div><div class="line"><span class="stringliteral">&quot;           / \&quot;\\\\\&quot; [0-7][0-7]? \n&quot;</span></div><div class="line"><span class="stringliteral">&quot;           / . \n&quot;</span></div><div class="line"><span class="stringliteral">&quot;Defined &lt;- \&quot;\\\\\&quot; [wWaAcCdDgGlLpPsSuUxX] S \n&quot;</span></div><div class="line"></div><div class="line"><span class="stringliteral">&quot;S &lt;- (\\s / \&quot;#\&quot; [^\\n]*)* \n&quot;</span></div><div class="line"><span class="stringliteral">&quot;Identifier &lt;- [A-Za-z_][A-Za-z0-9_-]* S \n&quot;</span></div><div class="line"><span class="stringliteral">&quot;Arrow &lt;- \&quot;&lt;-\&quot; S \n&quot;</span></div><div class="line"><span class="stringliteral">&quot;Number &lt;- [+-]? [0-9]+ S&quot;</span>;</div><div class="line"></div><div class="line">    <a class="code" href="structpt__grammar.html">pt_grammar</a> *g = create_grammar_from_string(re_grammar);</div><div class="line">    <a class="code" href="validate_8h.html#a70e2c6d46c25dfb416cc530d8badaf0d">pt_validate_grammar</a>(g, <a class="code" href="validate_8h.html#aaa7d39cc766a4fa8174efcd4e83f2244a0bb41d24958fe31b0c874e93bf4b5127">PT_VALIDATE_ABORT</a>);</div><div class="line"></div><div class="line">    <span class="comment">// Try to match itself</span></div><div class="line">    puts(<a class="code" href="match_8h.html#a785fdb8caba03abc57ebd541b45bcb37">pt_match_grammar</a>(g, re_grammar, NULL).matched &gt;= 0</div><div class="line">         ? <span class="stringliteral">&quot;PASS&quot;</span></div><div class="line">         : <span class="stringliteral">&quot;FAIL&quot;</span>);</div><div class="line"></div><div class="line">    <a class="code" href="grammar_8h.html#a89110044150ef30bf164bb83fccb2363">pt_destroy_grammar</a>(g);</div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --> </div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
