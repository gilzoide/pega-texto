<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>pega-texto: Tutorial</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">pega-texto
   </div>
   <div id="projectbrief">A runtime engine for Parsing Expression Grammars (PEG) in C</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Tutorial </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This tutorial will give you an overview of how to use <em>pega-texto</em>. Don't forget to also look at the reference manual and examples (I promise they're very informative!).</p>
<h2>Including and compiling </h2>
<p>First things first: include the main header.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="pega-texto_8h.html">pega-texto.h</a>&gt;</span></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv) {</div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --><p>To compile a program that uses <em>pega-texto</em>, just use the <code>-lpega-texto</code> linker flag, also available from the <code>pkg-config</code> command. You may also compile <em>pega-texto</em> as a static library by passing <code>-DBUILD_SHARED_LIBS=OFF</code> to <em>CMake</em>.</p>
<h2>Creating and destroying Expressions </h2>
<p>Expressions can be created by the <code>pt_create_*</code> functions in <code><a class="el" href="expr_8h.html" title="Parsing Expressions. ">pega-texto/expr.h</a></code> and destroyed with <code>pt_destroy_expr</code>. Remember, this is <em>C</em>: <b>always</b> free the memory you use!</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="pega-texto_8h.html">pega-texto.h</a>&gt;</span></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv) {</div><div class="line">    <a class="code" href="structpt__expr.html">pt_expr</a> *e = <a class="code" href="expr_8h.html#a7b388498190123948c0fbcaf9512b10c">pt_create_literal</a>(<span class="stringliteral">&quot;foo&quot;</span>, 0, NULL);</div><div class="line">    <a class="code" href="expr_8h.html#af21037b7ddc304b977c91bf8da57ac84">pt_destroy_expr</a>(e);</div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --><p>Creating complex Expressions this way is really boring to type and hard to read. That is why <em>pega-texto</em> offers macros for writing Expressions more easily. They can be turned on by including the <code><a class="el" href="macro-on_8h.html" title="Turn on Parsing Expression constructor macros. ">pega-texto/macro-on.h</a></code> header and turned off by including <code><a class="el" href="macro-off_8h.html" title="Turn off Parsing Expression constructor macros. ">pega-texto/macro-off.h</a></code>.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="pega-texto_8h.html">pega-texto.h</a>&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="macro-on_8h.html">pega-texto/macro-on.h</a>&gt;</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;ctype.h&gt;</span></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv) {</div><div class="line">    <a class="code" href="structpt__expr.html">pt_expr</a> *e = <a class="code" href="macro-on_8h.html#a1fbce1ef13f8b74cfd3c6ee4baa25ba3">SEQ</a>(<a class="code" href="macro-on_8h.html#abe07a63385acc4dc5ceb4fc6ad206510">Q</a>(<a class="code" href="macro-on_8h.html#a8fa17c8cf4c36df48f4108c36da8573e">S</a>(<span class="stringliteral">&quot;+-&quot;</span>), -1), <a class="code" href="macro-on_8h.html#abe07a63385acc4dc5ceb4fc6ad206510">Q</a>(<a class="code" href="macro-on_8h.html#ab25baccb41e3b67ef0bfdaa1336c9649">F</a>(isdigit), 1)); <span class="comment">// Match integer: [+-]? \d+</span></div><div class="line">    <a class="code" href="expr_8h.html#af21037b7ddc304b977c91bf8da57ac84">pt_destroy_expr</a>(e);</div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --><p>These macros may be turned off and aren't included by default because they may clash with other identifiers in the program, and putting the <code>PT_</code> prefix would make them too cumbersome to use.</p>
<h2>Matching </h2>
<p>With an Expression in hands, you may start to match strings with <code>pt_match_expr</code>. Match results contain the number of characters matched (non-negative values) or an error code (negative values), and the Action result (Actions will be covered below).</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="pega-texto_8h.html">pega-texto.h</a>&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="macro-on_8h.html">pega-texto/macro-on.h</a>&gt;</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;ctype.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv) {</div><div class="line">    <a class="code" href="structpt__expr.html">pt_expr</a> *e = <a class="code" href="macro-on_8h.html#a1fbce1ef13f8b74cfd3c6ee4baa25ba3">SEQ</a>(<a class="code" href="macro-on_8h.html#abe07a63385acc4dc5ceb4fc6ad206510">Q</a>(<a class="code" href="macro-on_8h.html#a8fa17c8cf4c36df48f4108c36da8573e">S</a>(<span class="stringliteral">&quot;+-&quot;</span>), -1), <a class="code" href="macro-on_8h.html#abe07a63385acc4dc5ceb4fc6ad206510">Q</a>(<a class="code" href="macro-on_8h.html#ab25baccb41e3b67ef0bfdaa1336c9649">F</a>(isdigit), 1)); <span class="comment">// Match integer: [+-]? \d+</span></div><div class="line">    <a class="code" href="structpt__match__result.html">pt_match_result</a> res;</div><div class="line">    res = <a class="code" href="match_8h.html#ae25bc2a2c3bdd3e2a9935f419759e4c4">pt_match_expr</a>(e, <span class="stringliteral">&quot;42 hello world!&quot;</span>, NULL);</div><div class="line">    <span class="keywordflow">if</span>(res.<a class="code" href="structpt__match__result.html#a2cac697b53844ad0bb0ab9487798c50f">matched</a> &gt; 0) {</div><div class="line">        printf(<span class="stringliteral">&quot;This will be printed! Matched %d characters.\n&quot;</span>, res.<a class="code" href="structpt__match__result.html#a2cac697b53844ad0bb0ab9487798c50f">matched</a>); <span class="comment">// res.matched == 2</span></div><div class="line">    }</div><div class="line">    res = <a class="code" href="match_8h.html#ae25bc2a2c3bdd3e2a9935f419759e4c4">pt_match_expr</a>(e, <span class="stringliteral">&quot;hello world! 42&quot;</span>, NULL);</div><div class="line">    <span class="keywordflow">if</span>(res.<a class="code" href="structpt__match__result.html#a2cac697b53844ad0bb0ab9487798c50f">matched</a> &gt; 0) {</div><div class="line">        puts(<span class="stringliteral">&quot;This will not =/&quot;</span>);</div><div class="line">    }</div><div class="line">    <a class="code" href="expr_8h.html#af21037b7ddc304b977c91bf8da57ac84">pt_destroy_expr</a>(e);</div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --><h2>Grammars </h2>
<p>Instead of single Expressions, you may use a Grammar for more complex languages. Grammars are formed by named Expressions. They are created using the <code>pt_create_grammar</code> function and destroyed with <code>pt_destroy_grammar</code>. Use the <code>pt_match_grammar</code> function to match when using Grammars.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="pega-texto_8h.html">pega-texto.h</a>&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="macro-on_8h.html">pega-texto/macro-on.h</a>&gt;</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;ctype.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv) {</div><div class="line">    <span class="comment">/* List  &lt;- Id (&quot;,&quot; Id)*</span></div><div class="line"><span class="comment">     * Id    &lt;- Space [A-Za-z]+ Space</span></div><div class="line"><span class="comment">     * Space &lt;- \s*</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <a class="code" href="structpt__rule.html">pt_rule</a> rules[] = {</div><div class="line">        { <span class="stringliteral">&quot;List&quot;</span>, <a class="code" href="macro-on_8h.html#a1fbce1ef13f8b74cfd3c6ee4baa25ba3">SEQ</a>(<a class="code" href="macro-on_8h.html#ad187b264cc8b274131c2009ec2359a1c">V</a>(<span class="stringliteral">&quot;Id&quot;</span>), <a class="code" href="macro-on_8h.html#abe07a63385acc4dc5ceb4fc6ad206510">Q</a>(<a class="code" href="macro-on_8h.html#a1fbce1ef13f8b74cfd3c6ee4baa25ba3">SEQ</a>(<a class="code" href="macro-on_8h.html#a3948ef94e164df6b50c4a9d12ba60eb5">L</a>(<span class="stringliteral">&quot;,&quot;</span>), <a class="code" href="macro-on_8h.html#ad187b264cc8b274131c2009ec2359a1c">V</a>(<span class="stringliteral">&quot;Id&quot;</span>)), 0)) },</div><div class="line">        { <span class="stringliteral">&quot;Id&quot;</span>, <a class="code" href="macro-on_8h.html#a1fbce1ef13f8b74cfd3c6ee4baa25ba3">SEQ</a>(<a class="code" href="macro-on_8h.html#ad187b264cc8b274131c2009ec2359a1c">V</a>(<span class="stringliteral">&quot;Space&quot;</span>), <a class="code" href="macro-on_8h.html#abe07a63385acc4dc5ceb4fc6ad206510">Q</a>(<a class="code" href="macro-on_8h.html#ab25baccb41e3b67ef0bfdaa1336c9649">F</a>(isalpha), 1), <a class="code" href="macro-on_8h.html#ad187b264cc8b274131c2009ec2359a1c">V</a>(<span class="stringliteral">&quot;Space&quot;</span>)) },</div><div class="line">        { <span class="stringliteral">&quot;Space&quot;</span>, <a class="code" href="macro-on_8h.html#abe07a63385acc4dc5ceb4fc6ad206510">Q</a>(<a class="code" href="macro-on_8h.html#ab25baccb41e3b67ef0bfdaa1336c9649">F</a>(isspace), 0) },</div><div class="line">        { NULL, NULL }, <span class="comment">// pega-texto uses NULL-terminated arrays for Rules</span></div><div class="line">    };</div><div class="line">    <a class="code" href="structpt__grammar.html">pt_grammar</a> *g = <a class="code" href="grammar_8h.html#a7874095f872e56f9bf96c7c92dc7399d">pt_create_grammar</a>(rules, 0);</div><div class="line">    <span class="keywordflow">if</span>(<a class="code" href="match_8h.html#a785fdb8caba03abc57ebd541b45bcb37">pt_match_grammar</a>(g, <span class="stringliteral">&quot;foo, bar, baz&quot;</span>, NULL).matched &gt; 0) {</div><div class="line">        puts(<span class="stringliteral">&quot;This will be printed!&quot;</span>);</div><div class="line">    }</div><div class="line">    <span class="keywordflow">if</span>(<a class="code" href="match_8h.html#a785fdb8caba03abc57ebd541b45bcb37">pt_match_grammar</a>(g, <span class="stringliteral">&quot;,,&quot;</span>, NULL).matched &gt; 0) {</div><div class="line">        puts(<span class="stringliteral">&quot;This will not =/&quot;</span>);</div><div class="line">    }</div><div class="line">    <a class="code" href="grammar_8h.html#a89110044150ef30bf164bb83fccb2363">pt_destroy_grammar</a>(g);</div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --><p>Grammars should be well-formed, as described by <a href="https://pdos.csail.mit.edu/~baford/packrat/popl04/peg-popl04.pdf">Ford (2014)</a>, for the matching algorithm to not enter an infinite loop. As for the implementation, Non-terminal names should exist and some pointers should not be <code>NULL</code> for preventing SEGFAULTs. One should always validate the Grammar using the <code>pt_validate_grammar</code> function. This function may only return the result, print error messages to <code>stderr</code>, abort the program, or even not validate the Grammar at all. This is useful if you want to validate the well-formedness of the Grammar only on debug builds.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="pega-texto_8h.html">pega-texto.h</a>&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="macro-on_8h.html">pega-texto/macro-on.h</a>&gt;</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;ctype.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div><div class="line"></div><div class="line"><span class="preprocessor">#ifdef NDEBUG</span></div><div class="line"><span class="preprocessor"># define VALIDATION_BEHAVIOUR PT_VALIDATE_SKIP</span></div><div class="line"><span class="preprocessor">#else</span></div><div class="line"><span class="preprocessor"># define VALIDATION_BEHAVIOUR PT_VALIDATE_ABORT</span></div><div class="line"><span class="preprocessor">#endif</span></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv) {</div><div class="line">    <span class="comment">/* List  &lt;- Id (&quot;,&quot; Id)*</span></div><div class="line"><span class="comment">     * Id    &lt;- Space [A-Za-z]+ Space</span></div><div class="line"><span class="comment">     * Space &lt;- \s*</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <a class="code" href="structpt__rule.html">pt_rule</a> rules[] = {</div><div class="line">        { <span class="stringliteral">&quot;List&quot;</span>, <a class="code" href="macro-on_8h.html#a1fbce1ef13f8b74cfd3c6ee4baa25ba3">SEQ</a>(<a class="code" href="macro-on_8h.html#ad187b264cc8b274131c2009ec2359a1c">V</a>(<span class="stringliteral">&quot;Id&quot;</span>), <a class="code" href="macro-on_8h.html#abe07a63385acc4dc5ceb4fc6ad206510">Q</a>(<a class="code" href="macro-on_8h.html#a1fbce1ef13f8b74cfd3c6ee4baa25ba3">SEQ</a>(<a class="code" href="macro-on_8h.html#a3948ef94e164df6b50c4a9d12ba60eb5">L</a>(<span class="stringliteral">&quot;,&quot;</span>), <a class="code" href="macro-on_8h.html#ad187b264cc8b274131c2009ec2359a1c">V</a>(<span class="stringliteral">&quot;Id&quot;</span>)), 0)) },</div><div class="line">        { <span class="stringliteral">&quot;Id&quot;</span>, <a class="code" href="macro-on_8h.html#a1fbce1ef13f8b74cfd3c6ee4baa25ba3">SEQ</a>(<a class="code" href="macro-on_8h.html#ad187b264cc8b274131c2009ec2359a1c">V</a>(<span class="stringliteral">&quot;Space&quot;</span>), <a class="code" href="macro-on_8h.html#abe07a63385acc4dc5ceb4fc6ad206510">Q</a>(<a class="code" href="macro-on_8h.html#ab25baccb41e3b67ef0bfdaa1336c9649">F</a>(isalpha), 1), <a class="code" href="macro-on_8h.html#ad187b264cc8b274131c2009ec2359a1c">V</a>(<span class="stringliteral">&quot;Space&quot;</span>)) },</div><div class="line">        { <span class="stringliteral">&quot;Space&quot;</span>, <a class="code" href="macro-on_8h.html#abe07a63385acc4dc5ceb4fc6ad206510">Q</a>(<a class="code" href="macro-on_8h.html#ab25baccb41e3b67ef0bfdaa1336c9649">F</a>(isspace), 0) },</div><div class="line">        { NULL, NULL }, <span class="comment">// pega-texto uses NULL-terminated arrays for Rules</span></div><div class="line">    };</div><div class="line">    <a class="code" href="structpt__grammar.html">pt_grammar</a> *g = <a class="code" href="grammar_8h.html#a7874095f872e56f9bf96c7c92dc7399d">pt_create_grammar</a>(rules, 0);</div><div class="line">    <span class="keywordflow">if</span>(<a class="code" href="validate_8h.html#a70e2c6d46c25dfb416cc530d8badaf0d">pt_validate_grammar</a>(g, VALIDATION_BEHAVIOUR).status != <a class="code" href="validate_8h.html#a4a31154ceb166ab46d3fb33af6446605aa2a0068915726c8e6c6f225ef6f01360">PT_VALIDATE_SUCCESS</a>) {</div><div class="line">        <span class="comment">// oh no! Grammar is well-formed, so this will be a malloc error</span></div><div class="line">    }</div><div class="line">    <span class="comment">/* ... */</span></div><div class="line">    <a class="code" href="grammar_8h.html#a89110044150ef30bf164bb83fccb2363">pt_destroy_grammar</a>(g);</div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --><h2>Actions </h2>
<p>Matching strings make more sense when you can actually use their value for something. Presenting: Actions! Actions are functions that process the matched part of the input and return some data, and are run only if the whole match succeeds. Expressions may be enclosed in others, and the results produced on inner Actions are passed as arguments for the outer ones, in a <em>fold/reduce</em> style.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="pega-texto_8h.html">pega-texto.h</a>&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="macro-on_8h.html">pega-texto/macro-on.h</a>&gt;</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;stdlib.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;ctype.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;string.h&gt;</span></div><div class="line"></div><div class="line"><span class="preprocessor">#ifdef NDEBUG</span></div><div class="line"><span class="preprocessor"># define VALIDATION_BEHAVIOUR PT_VALIDATE_SKIP</span></div><div class="line"><span class="preprocessor">#else</span></div><div class="line"><span class="preprocessor"># define VALIDATION_BEHAVIOUR PT_VALIDATE_ABORT</span></div><div class="line"><span class="preprocessor">#endif</span></div><div class="line"></div><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>{</div><div class="line">    <span class="keywordtype">int</span> size;</div><div class="line">    <span class="keywordtype">char</span> **ids;</div><div class="line">} List;</div><div class="line"></div><div class="line"><a class="code" href="unionpt__data.html">pt_data</a> copy_identifier(<span class="keyword">const</span> <span class="keywordtype">char</span> *str, <span class="keywordtype">size_t</span> start, <span class="keywordtype">size_t</span> end, <span class="keywordtype">int</span> argc, <a class="code" href="unionpt__data.html">pt_data</a> *argv, <span class="keywordtype">void</span> *data) {</div><div class="line">    <span class="keywordtype">char</span> *identifier = strndup(str + start, end - start);</div><div class="line">    <span class="keywordflow">return</span> (<a class="code" href="unionpt__data.html">pt_data</a>){ .p = identifier };</div><div class="line">}</div><div class="line"></div><div class="line"><a class="code" href="unionpt__data.html">pt_data</a> generate_list(<span class="keyword">const</span> <span class="keywordtype">char</span> *str, <span class="keywordtype">size_t</span> start, <span class="keywordtype">size_t</span> end, <span class="keywordtype">int</span> argc, <a class="code" href="unionpt__data.html">pt_data</a> *argv, <span class="keywordtype">void</span> *data) {</div><div class="line">    List *l = malloc(<span class="keyword">sizeof</span>(List));</div><div class="line">    <span class="keywordflow">if</span>(l) {</div><div class="line">        l-&gt;ids = malloc(argc * <span class="keyword">sizeof</span>(<span class="keywordtype">char</span> *));</div><div class="line">        <span class="keywordflow">if</span>(l-&gt;ids) {</div><div class="line">            <span class="keywordtype">int</span> i;</div><div class="line">            <span class="keywordflow">for</span>(i = 0; i &lt; argc; i++) {</div><div class="line">                l-&gt;ids[i] = argv[i].p;</div><div class="line">            }</div><div class="line">            l-&gt;size = argc;</div><div class="line">        }</div><div class="line">        <span class="keywordflow">else</span> {</div><div class="line">            l-&gt;size = 0;</div><div class="line">        }</div><div class="line">    }</div><div class="line">    <span class="keywordflow">return</span> (<a class="code" href="unionpt__data.html">pt_data</a>){ .p = l };</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> destroy_list(List *l) {</div><div class="line">    <span class="keywordtype">int</span> i;</div><div class="line">    <span class="keywordflow">for</span>(i = 0; i &lt; l-&gt;size; i++) {</div><div class="line">        free(l-&gt;ids[i]);</div><div class="line">    }</div><div class="line">    free(l-&gt;ids);</div><div class="line">    free(l);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv) {</div><div class="line">    <span class="comment">/* List  &lt;- Id (&quot;,&quot; Id)*</span></div><div class="line"><span class="comment">     * Id    &lt;- Space [A-Za-z]+ Space</span></div><div class="line"><span class="comment">     * Space &lt;- \s*</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <a class="code" href="structpt__rule.html">pt_rule</a> rules[] = {</div><div class="line">        { <span class="stringliteral">&quot;List&quot;</span>, SEQ_(generate_list, <a class="code" href="macro-on_8h.html#ad187b264cc8b274131c2009ec2359a1c">V</a>(<span class="stringliteral">&quot;Id&quot;</span>), <a class="code" href="macro-on_8h.html#abe07a63385acc4dc5ceb4fc6ad206510">Q</a>(<a class="code" href="macro-on_8h.html#a1fbce1ef13f8b74cfd3c6ee4baa25ba3">SEQ</a>(<a class="code" href="macro-on_8h.html#a3948ef94e164df6b50c4a9d12ba60eb5">L</a>(<span class="stringliteral">&quot;,&quot;</span>), <a class="code" href="macro-on_8h.html#ad187b264cc8b274131c2009ec2359a1c">V</a>(<span class="stringliteral">&quot;Id&quot;</span>)), 0)) },</div><div class="line">        { <span class="stringliteral">&quot;Id&quot;</span>, <a class="code" href="macro-on_8h.html#a1fbce1ef13f8b74cfd3c6ee4baa25ba3">SEQ</a>(<a class="code" href="macro-on_8h.html#ad187b264cc8b274131c2009ec2359a1c">V</a>(<span class="stringliteral">&quot;Space&quot;</span>), Q_(copy_identifier, <a class="code" href="macro-on_8h.html#ab25baccb41e3b67ef0bfdaa1336c9649">F</a>(isalpha), 1), <a class="code" href="macro-on_8h.html#ad187b264cc8b274131c2009ec2359a1c">V</a>(<span class="stringliteral">&quot;Space&quot;</span>)) },</div><div class="line">        { <span class="stringliteral">&quot;Space&quot;</span>, <a class="code" href="macro-on_8h.html#abe07a63385acc4dc5ceb4fc6ad206510">Q</a>(<a class="code" href="macro-on_8h.html#ab25baccb41e3b67ef0bfdaa1336c9649">F</a>(isspace), 0) },</div><div class="line">        { NULL, NULL }, <span class="comment">// pega-texto uses NULL-terminated arrays for Rules</span></div><div class="line">    };</div><div class="line">    <a class="code" href="structpt__grammar.html">pt_grammar</a> *g = <a class="code" href="grammar_8h.html#a7874095f872e56f9bf96c7c92dc7399d">pt_create_grammar</a>(rules, 0);</div><div class="line">    <span class="keywordflow">if</span>(<a class="code" href="validate_8h.html#a70e2c6d46c25dfb416cc530d8badaf0d">pt_validate_grammar</a>(g, VALIDATION_BEHAVIOUR).status != <a class="code" href="validate_8h.html#a4a31154ceb166ab46d3fb33af6446605aa2a0068915726c8e6c6f225ef6f01360">PT_VALIDATE_SUCCESS</a>) {</div><div class="line">        <span class="comment">// oh no! Grammar is well-formed, so this will be a malloc error</span></div><div class="line">    }</div><div class="line"></div><div class="line">    <a class="code" href="structpt__match__result.html">pt_match_result</a> res = <a class="code" href="match_8h.html#a785fdb8caba03abc57ebd541b45bcb37">pt_match_grammar</a>(g, <span class="stringliteral">&quot;foo, bar, baz&quot;</span>, NULL);</div><div class="line">    <span class="keywordflow">if</span>(res.<a class="code" href="structpt__match__result.html#a2cac697b53844ad0bb0ab9487798c50f">matched</a> &gt; 0) {</div><div class="line">        List *l = res.<a class="code" href="structpt__match__result.html#a3e2395bb9e7a99111250ab2a8f1519ec">data</a>.p;</div><div class="line">        <span class="keywordtype">int</span> i;</div><div class="line">        <span class="keywordflow">for</span>(i = 0; i &lt; l-&gt;size; i++) {</div><div class="line">            printf(<span class="stringliteral">&quot;%s &quot;</span>, l-&gt;ids[i]);</div><div class="line">        }</div><div class="line">        destroy_list(l);</div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span> {</div><div class="line">        puts(<span class="stringliteral">&quot;This will not be printed&quot;</span>);</div><div class="line">    }</div><div class="line"></div><div class="line">    <a class="code" href="grammar_8h.html#a89110044150ef30bf164bb83fccb2363">pt_destroy_grammar</a>(g);</div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --><h2>Error Handling </h2>
<p><em>Pega-texto</em> offers an Error Expression that, when matched, immediately run an error callback receiving the numeric error code provided in the Expression, with an optional syncronization Expression. When there is no syncronization Expression, the whole match fails instantly. Otherwise, <em>pega-texto</em> looks for the syncronization Expression and resume the matching there. Either way, <code>PT_MATCHED_ERROR</code> is returned and no Actions are executed.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="pega-texto_8h.html">pega-texto.h</a>&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="macro-on_8h.html">pega-texto/macro-on.h</a>&gt;</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;ctype.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;assert.h&gt;</span></div><div class="line"></div><div class="line"><span class="preprocessor">#ifdef NDEBUG</span></div><div class="line"><span class="preprocessor"># define VALIDATION_BEHAVIOUR PT_VALIDATE_SKIP</span></div><div class="line"><span class="preprocessor">#else</span></div><div class="line"><span class="preprocessor"># define VALIDATION_BEHAVIOUR PT_VALIDATE_ABORT</span></div><div class="line"><span class="preprocessor">#endif</span></div><div class="line"></div><div class="line"><span class="keywordtype">void</span> error_callback(<span class="keyword">const</span> <span class="keywordtype">char</span> *str, <span class="keywordtype">size_t</span> where, <span class="keywordtype">int</span> code, <span class="keywordtype">void</span> *data) {</div><div class="line">    fprintf(stderr, <span class="stringliteral">&quot;Invalid identifier found at position %u\n&quot;</span>, where + 1);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv) {</div><div class="line">    <span class="comment">/* List  &lt;- Id (&quot;,&quot; Id)*</span></div><div class="line"><span class="comment">     * Id    &lt;- Space [A-Za-z]+ Space / Error(1, &quot;,&quot;)</span></div><div class="line"><span class="comment">     * Space &lt;- \s*</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <a class="code" href="structpt__rule.html">pt_rule</a> rules[] = {</div><div class="line">        { <span class="stringliteral">&quot;List&quot;</span>, <a class="code" href="macro-on_8h.html#a1fbce1ef13f8b74cfd3c6ee4baa25ba3">SEQ</a>(<a class="code" href="macro-on_8h.html#ad187b264cc8b274131c2009ec2359a1c">V</a>(<span class="stringliteral">&quot;Id&quot;</span>), <a class="code" href="macro-on_8h.html#abe07a63385acc4dc5ceb4fc6ad206510">Q</a>(<a class="code" href="macro-on_8h.html#a1fbce1ef13f8b74cfd3c6ee4baa25ba3">SEQ</a>(<a class="code" href="macro-on_8h.html#a3948ef94e164df6b50c4a9d12ba60eb5">L</a>(<span class="stringliteral">&quot;,&quot;</span>), <a class="code" href="macro-on_8h.html#ad187b264cc8b274131c2009ec2359a1c">V</a>(<span class="stringliteral">&quot;Id&quot;</span>)), 0)) },</div><div class="line">        { <span class="stringliteral">&quot;Id&quot;</span>, <a class="code" href="macro-on_8h.html#a1fbce1ef13f8b74cfd3c6ee4baa25ba3">SEQ</a>(<a class="code" href="macro-on_8h.html#ad187b264cc8b274131c2009ec2359a1c">V</a>(<span class="stringliteral">&quot;Space&quot;</span>), <a class="code" href="macro-on_8h.html#aa8c4cbd9ef7da8b278b5f80373eadae5">OR</a>(<a class="code" href="macro-on_8h.html#abe07a63385acc4dc5ceb4fc6ad206510">Q</a>(<a class="code" href="macro-on_8h.html#ab25baccb41e3b67ef0bfdaa1336c9649">F</a>(isalpha), 1), <a class="code" href="macro-on_8h.html#a804f66f4406ec6b2cb4c738a9481e230">E</a>(1, <a class="code" href="macro-on_8h.html#a3948ef94e164df6b50c4a9d12ba60eb5">L</a>(<span class="stringliteral">&quot;,&quot;</span>))), <a class="code" href="macro-on_8h.html#ad187b264cc8b274131c2009ec2359a1c">V</a>(<span class="stringliteral">&quot;Space&quot;</span>)) },</div><div class="line">        { <span class="stringliteral">&quot;Space&quot;</span>, <a class="code" href="macro-on_8h.html#abe07a63385acc4dc5ceb4fc6ad206510">Q</a>(<a class="code" href="macro-on_8h.html#ab25baccb41e3b67ef0bfdaa1336c9649">F</a>(isspace), 0) },</div><div class="line">        { NULL, NULL }, <span class="comment">// pega-texto uses NULL-terminated arrays for Rules</span></div><div class="line">    };</div><div class="line">    <a class="code" href="structpt__grammar.html">pt_grammar</a> *g = <a class="code" href="grammar_8h.html#a7874095f872e56f9bf96c7c92dc7399d">pt_create_grammar</a>(rules, 0);</div><div class="line">    <span class="keywordflow">if</span>(<a class="code" href="validate_8h.html#a70e2c6d46c25dfb416cc530d8badaf0d">pt_validate_grammar</a>(g, VALIDATION_BEHAVIOUR).status != <a class="code" href="validate_8h.html#a4a31154ceb166ab46d3fb33af6446605aa2a0068915726c8e6c6f225ef6f01360">PT_VALIDATE_SUCCESS</a>) {</div><div class="line">        <span class="comment">// oh no! Grammar is well-formed, so this will be a malloc error</span></div><div class="line">    }</div><div class="line"></div><div class="line">    <a class="code" href="structpt__match__options.html">pt_match_options</a> opts = { .<a class="code" href="structpt__match__options.html#ade82cad6a5131a16ad20599528ca99a4">on_error</a> = error_callback };</div><div class="line">    <a class="code" href="structpt__match__result.html">pt_match_result</a> res = <a class="code" href="match_8h.html#a785fdb8caba03abc57ebd541b45bcb37">pt_match_grammar</a>(g, <span class="stringliteral">&quot;foo, &#39;invalid&#39;, baz,,&quot;</span>, &amp;opts);</div><div class="line">    assert(res.<a class="code" href="structpt__match__result.html#a2cac697b53844ad0bb0ab9487798c50f">matched</a> == <a class="code" href="match_8h.html#ae6592b49fc3b4d6afaf0dbea6a6c6dbdae7ed631ef63d879a982c4b5f8df25282">PT_MATCHED_ERROR</a>);</div><div class="line"></div><div class="line">    <a class="code" href="grammar_8h.html#a89110044150ef30bf164bb83fccb2363">pt_destroy_grammar</a>(g);</div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --> </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
